function startRecordingEvent(){"use strict";this.disabled=!0,navigator.getUserMedia({audio:!0},function(e){recordAudio=new RecordRTC(e,{type:"audio",recorderType:StereoAudioRecorder}),recordAudio.initRecorder(function(){canvasRecorder.startRecording(),recordAudio.startRecording()}),stopButton.disabled=!1},function(e){log(JSON.stringify(e))}),startButton.style.display="none",pauseButton.style.display="inline-block",stopButton.style.display="inline-block"}function stopRecordingEvent(){"use strict";compilemessageDiv.style.display="inline-block",overlayDiv.style.display="block",this.disabled=!0,recordAudio.stopRecording(function(){canvasRecorder.stopRecording(function(){convertStreams(canvasRecorder.blob,recordAudio.blob),log('<a href="'+workerPath+'" download="ffmpeg-asm.js">ffmpeg-asm.js</a> file download started. It is about 18MB in size; please be patient!')})}),startButton.disabled=!1,pauseButton.style.display="none",resumeButton.style.display="none",stopButton.style.display="none"}function pauseRecordingEvent(){"use strict";canvasRecorder.pauseRecording(),pauseButton.style.display="none",resumeButton.style.display="inline-block"}function resumeRecordingEvent(){"use strict";canvasRecorder.resumeRecording(),resumeButton.style.display="none",pauseButton.style.display="inline-block"}function processInWebWorker(){"use strict";var e=URL.createObjectURL(new Blob(['importScripts("'+workerPath+'");var now = Date.now;function print(text) {postMessage({"type" : "stdout","data" : text});};onmessage = function(event) {var message = event.data;if (message.type === "command") {var Module = {print: print,printErr: print,files: message.files || [],arguments: message.arguments || [],TOTAL_MEMORY: 268435456};postMessage({"type" : "start","data" : Module.arguments.join(" ")});postMessage({"type" : "stdout","data" : "Received command: " +Module.arguments.join(" ") +((Module.TOTAL_MEMORY) ? ".  Processing with " + Module.TOTAL_MEMORY + " bits." : "")});var time = now();var result = ffmpeg_run(Module);var totalTime = now() - time;postMessage({"type" : "stdout","data" : "Finished processing (took " + totalTime + "ms)"});postMessage({"type" : "done","data" : result,"time" : totalTime});}};postMessage({"type" : "ready"});'],{type:"application/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t}function convertStreams(e,t){"use strict";var o,n,s,a,r=!1,i=new FileReader;i.onload=function(){o=this.result,n&&(s=!0),s&&a&&!r&&l()};var d=new FileReader;d.onload=function(){n=this.result,o&&(s=!0),s&&a&&!r&&l()},i.readAsArrayBuffer(e),d.readAsArrayBuffer(t),worker||(worker=processInWebWorker()),worker.onmessage=function(e){var t=e.data;if("ready"==t.type)log('<a href="'+workerPath+'" download="ffmpeg-asm.js">ffmpeg-asm.js</a> file has been loaded.'),a=!0,s&&l();else if("stdout"==t.type)log(t.data);else if("start"==t.type)log('<a href="'+workerPath+'" download="ffmpeg-asm.js">ffmpeg-asm.js</a> file received ffmpeg command.');else if("done"==t.type){log(JSON.stringify(t));var o=t.data[0];log(JSON.stringify(o));var n=new Blob([o.data],{type:"video/mp4"});log(JSON.stringify(n)),PostBlob(n)}};var l=function(){r=!0,worker.postMessage({type:"command",arguments:["-i","video.webm","-i","audio.wav","-c:v","mpeg4","-c:a","vorbis","-b:v","2200k","-b:a","4800k","-strict","experimental","output.mp4"],files:[{data:new Uint8Array(o),name:"video.webm"},{data:new Uint8Array(n),name:"audio.wav"}]})}}function PostBlob(e){h2.innerHTML='<a href="'+URL.createObjectURL(e)+'" target="_blank" download="Recording_'+Date.now()+'.mp4">Download recorded mp4 file</a>',h2.setAttribute("contenteditable","false"),startButton.style.display="inline-block",messageDiv.style.display="inline-block",overlayDiv.style.display="none"}function log(e){h2.innerHTML=e,console.log(e)}var elementToShare=document.getElementById("elementToShare"),canvasRecorder=new RecordRTC(elementToShare,{type:"canvas",recorderType:CanvasRecorder}),recordAudio,startButton=document.getElementById("start"),stopButton=document.getElementById("stop"),pauseButton=document.getElementById("pause"),resumeButton=document.getElementById("resume"),overlayDiv=document.getElementById("overlay"),messageDiv=document.getElementById("message"),compilemessageDiv=document.getElementById("compilemessage");startButton.addEventListener("click",startRecordingEvent),stopButton.addEventListener("click",stopRecordingEvent),pauseButton.addEventListener("click",pauseRecordingEvent),resumeButton.addEventListener("click",resumeRecordingEvent);var workerPath=window.location.href+"js/lib/ffmpeg_asm.js",worker,h2=document.querySelector("h2");